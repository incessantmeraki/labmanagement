var koa   = require('koa');
var mysql = require('../index.js');

var app = koa();

var opt = { debug: true, host: 'localhost', user: 'root', password: '' };
var pool = mysql.createPool(opt);

app.use(function* mysqlConnection(next) {
    this.db = yield pool.getConnection();
    yield next;
    this.db.release();
});

app.use(function* query(next) {
    debugger;
    console.log(this.db.query.toString());
    var result = yield this.db.query('show processlist');
    console.log(result[0]);
});

app.listen(3000);
